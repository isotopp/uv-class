<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Dependencies, environments, and reproducibility
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="/books/uv-class/05-dependencies/"><meta property="og:site_name" content="Using uv to manage python projects"><meta property="og:title" content="Dependencies, environments, and reproducibility"><meta property="og:description" content="Dependencies, environments, and reproducibility"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Dependencies, environments, and reproducibility"><meta itemprop=description content="Dependencies, environments, and reproducibility"><meta itemprop=datePublished content="2025-12-22T00:00:00+00:00"><meta itemprop=dateModified content="2025-12-22T00:00:00+00:00"><meta itemprop=wordCount content="2199"><title>Dependencies, environments, and reproducibility | Using uv to manage python projects</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=/books/uv-class/05-dependencies/><link rel=stylesheet href=/book.min.85f17b518e8256eab1e39806e72b3659c4c4eab4911a3ac293d064c90fc68a8d.css><script defer src=/fuse.min.js></script><script defer src=/en.search.min.06aecd479b9ef04d026622d0d2f0249fdf8ce699a5db8e96d3cdc229d27f4823.js></script><link rel=alternate type=application/rss+xml href=/books/uv-class/05-dependencies/index.xml title="Using uv to manage python projects"></head><body dir=ltr class="book-kind-section book-type-books"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Using uv to manage python projects</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/posts/>What's new?</a></li></ul><ul><li><input type=checkbox id=section-5c7e9da1f7ea456d914790ef3a5c9d96 class=toggle checked>
<label for=section-5c7e9da1f7ea456d914790ef3a5c9d96 class=flex><a href=/books/uv-class/>Using uv to manage python projects</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/books/uv-class/01-installation/>Installing and Configuring uv</a><ul></ul></li><li><a href=/books/uv-class/02-what-is-uv/>What uv is and how it works</a><ul></ul></li><li><a href=/books/uv-class/03-python-projects/>A sample project and a walkthrough</a><ul></ul></li><li><a href=/books/uv-class/04-basics/>General Options and TOML</a><ul></ul></li><li><a href=/books/uv-class/05-dependencies/ class=active>Dependencies, environments, and reproducibility</a><ul></ul></li><li><a href=/books/uv-class/06-running/>Running code and tools consistently</a><ul></ul></li><li><a href=/books/uv-class/07-collaboration/>Project hygiene and collaboration</a><ul></ul></li><li><a href=/books/uv-class/08-build-and-publish/>Building, packaging, and publishing</a><ul></ul></li><li><a href=/books/uv-class/09-uv-migration/>uv in context: migration and judgment</a><ul></ul></li><li><a href=/books/uv-class/90-python-and-c-projects/>Using uv to extend Python with C-code</a><ul></ul></li></ul></li></ul><ul><li><a href=https://github.com/isotopp/uv-class target=_blank rel=noopener>Repo for this site</a></li><li><a href=https://themes.gohugo.io/themes/hugo-book/ target=_blank rel=noopener>Made with Hugo Book</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>Dependencies, environments, and reproducibility</h3><label for=toc-control><img src=/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><ul><li><a href=#topics>Topics</a></li></ul></li><li><a href=#python-projects-and-dependencies>Python Projects and Dependencies</a><ul><li><a href=#adding-and-removing-dependencies>Adding and removing dependencies</a><ul><li><a href=#uv-add><code>uv add</code></a></li><li><a href=#uv-remove><code>uv remove</code></a></li></ul></li><li><a href=#runtime-vs-development-dependencies>Runtime vs development dependencies</a><ul><li><a href=#runtime-dependencies>Runtime Dependencies</a></li><li><a href=#development-dependencies---dev>Development Dependencies (<code>--dev</code>)</a></li><li><a href=#dependency-groups---group-name>Dependency Groups (<code>--group &lt;name></code>)</a></li></ul></li><li><a href=#dependency-resolution>Dependency resolution</a></li><li><a href=#lockfiles>Lockfiles</a></li><li><a href=#uv-sync-and-uv-run><code>uv sync</code> and <code>uv run</code></a></li><li><a href=#upgrading-with-uv-lock>Upgrading with <code>uv lock</code></a></li><li><a href=#sharing-projects-and-deterministic-installs>Sharing projects and deterministic installs</a></li></ul></li><li><a href=#dependencies-and-docker-installs>Dependencies and Docker Installs</a><ul><li><a href=#layer-caching-and---no-install-project>Layer Caching and <code>--no-install-project</code></a></li><li><a href=#reducing-image-size-with---no-dev-and---only-group>Reducing Image Size with <code>--no-dev</code> and <code>--only-group</code></a></li><li><a href=#summary-of-exclusions>Summary of Exclusions</a></li></ul></li><li><a href=#installation>Installation</a><ul><li><a href=#installer-options>Installer Options</a><ul><li><a href=#--link-mode><code>--link-mode</code></a></li><li><a href=#--reinstall-and---reinstall-package><code>--reinstall</code> and <code>--reinstall-package</code></a></li><li><a href=#--compile-bytecode><code>--compile-bytecode</code></a></li></ul></li><li><a href=#cache-options>Cache Options</a></li><li><a href=#python-discovery-and-managed-python>Python Discovery and Managed Python</a><ul><li><a href=#--managed-python><code>--managed-python</code></a></li></ul></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><details open><summary><strong>Summary</strong></summary><div class=markdown-inner><p><strong>Dependency Management:</strong> Use <code>uv add</code> and <code>uv remove</code> to manage dependencies. <code>uv</code> updates <code>pyproject.toml</code> and <code>uv.lock</code> simultaneously.</p><p><strong>Lockfiles:</strong> The <code>uv.lock</code> file ensures reproducible environments across all machines by recording exact versions and hashes.</p><p><strong>Syncing:</strong> <code>uv sync</code> ensures the virtual environment matches the lockfile.</p><p><strong>Docker Optimization:</strong> Use flags like <code>--no-install-project</code>, <code>--no-install-local</code>, and <code>--no-dev</code> to optimize Docker layers and reduce image size.</p></div></details><h2 id=topics>Topics<a class=anchor href=#topics>#</a></h2><ul><li>Adding and removing dependencies<ul><li><code>uv add</code></li><li><code>uv remove</code></li></ul></li><li>Runtime vs development dependencies<ul><li><code>uv add --dev</code>, <code>uv remove --dev</code></li><li><code>uv add --group &lt;name></code>, <code>uv remove --group &lt;name></code></li></ul></li><li>Dependency resolution<ul><li>When?</li><li>What is considered?</li><li>Versions, Version ranges, what is chosen?</li></ul></li><li>Lockfiles<ul><li>What <code>uv.lock</code> contains</li><li>Why it exists</li><li>Why lockfiles belong in <code>git</code></li></ul></li><li><code>uv sync</code> and <code>uv run</code><ul><li>What they read</li><li>Why lockfiles are authoritative</li></ul></li><li>Upgrading with <code>uv lock</code></li><li>Sharing projects and deterministic installs</li><li>Dependencies and Docker Installs<ul><li><code>--no-install-project</code></li><li><code>--no-install-local</code></li><li><code>--no-dev</code></li><li><code>--only-group &lt;name></code></li><li>Layer caching strategies</li></ul></li><li>Installation<ul><li>Installer options: <code>--link-mode</code>, <code>--reinstall</code>, <code>--compile-bytecode</code></li><li>Cache options: <code>--no-cache</code>, <code>--refresh</code></li><li>Python discovery and <code>--managed-python</code></li></ul></li></ul><h1 id=python-projects-and-dependencies>Python Projects and Dependencies<a class=anchor href=#python-projects-and-dependencies>#</a></h1><p>After getting the basics out of the way,
let&rsquo;s dive deeper into how <code>uv</code> handles dependencies and why it does things the way it does,
using our <code>berlin-weather</code> project as a reference.</p><h2 id=adding-and-removing-dependencies>Adding and removing dependencies<a class=anchor href=#adding-and-removing-dependencies>#</a></h2><p>Managing dependencies in <code>uv</code> is primarily done through the <code>uv add</code> and <code>uv remove</code> commands.</p><h3 id=uv-add><code>uv add</code><a class=anchor href=#uv-add>#</a></h3><p>When we ran <code>uv add httpx</code> in the <code>berlin-weather</code> project, <code>uv</code> performed several actions:</p><ol><li>It looked up <code>httpx</code> on PyPI.</li><li>It found the latest compatible version.</li><li>It updated the <code>dependencies</code> array in <code>pyproject.toml</code>.</li><li>It resolved the entire dependency tree (including <code>httpx</code>&rsquo;s own dependencies like <code>anyio</code> and <code>httpcore</code>).</li><li>It updated the <code>uv.lock</code> file with the exact versions and checksums.</li><li>It synchronized the virtual environment in <code>.venv</code>.</li></ol><p><strong>Why this way?</strong>
By updating both <code>pyproject.toml</code> (your intent) and <code>uv.lock</code> (the resolution) immediately,
<code>uv</code> ensures that your development environment is always in sync with your declarations.</p><h3 id=uv-remove><code>uv remove</code><a class=anchor href=#uv-remove>#</a></h3><p>Similarly, <code>uv remove httpx</code> would:</p><ol><li>Remove the entry from <code>pyproject.toml</code>.</li><li>Re-resolve the project (removing any transitive dependencies that are no longer needed).</li><li>Update <code>uv.lock</code>.</li><li>Clean up the <code>.venv</code>.</li></ol><h2 id=runtime-vs-development-dependencies>Runtime vs development dependencies<a class=anchor href=#runtime-vs-development-dependencies>#</a></h2><p>Not all dependencies are needed to run the application. Some are only needed for development or testing.</p><h3 id=runtime-dependencies>Runtime Dependencies<a class=anchor href=#runtime-dependencies>#</a></h3><p>These are required for the application to function.
In <code>berlin-weather</code>, <code>httpx</code> is a runtime dependency.
They are stored in the <code>[project.dependencies]</code> section of <code>pyproject.toml</code>.</p><h3 id=development-dependencies---dev>Development Dependencies (<code>--dev</code>)<a class=anchor href=#development-dependencies---dev>#</a></h3><p>Tools like <code>ruff</code> (for formatting) or <code>mypy</code> (for type checking) are not needed by the end-user of your weather app.
By running <code>uv add --dev ruff mypy</code>, you tell <code>uv</code> to put these in a special <code>dev</code> group.</p><ul><li>These are stored under <code>[dependency-groups]</code> in <code>pyproject.toml</code>.</li><li>They are included in your local development environment by default.</li></ul><h3 id=dependency-groups---group-name>Dependency Groups (<code>--group &lt;name></code>)<a class=anchor href=#dependency-groups---group-name>#</a></h3><p>You can create arbitrary groups for specific needs.
<code>--dev</code> is just a shorthand for the longer <code>--group dev</code> option,
because about every projecy will need development dependencies.
But we can create arbitarily named groups, and add dependencies to them.</p><p>Another commonly used group is <code>test</code>.
We used <code>uv add --group test pytest</code> for our testing framework.</p><p>This allows a CI system to install <em>only</em> what it needs (e.g., <code>uv sync --group test</code> might be enough to run tests,
avoiding the overhead of <code>mypy</code> or <code>ruff</code> if those are not run as part of the testing cycle).</p><h2 id=dependency-resolution>Dependency resolution<a class=anchor href=#dependency-resolution>#</a></h2><p>Resolution is the process of finding a set of package versions that satisfy all constraints.</p><dl><dt>When does it happen?</dt><dd>Every time you <code>add</code>, <code>remove</code>, or run <code>uv lock</code>.
<code>uv</code> is designed to be so fast that it can re-resolve the entire project frequently.
What is considered?</dd><dd><code>uv</code> considers all dependency groups during resolution.
Versions and Ranges</dd><dd>By default, <code>uv add</code> uses &ldquo;compatible&rdquo; version ranges (e.g., <code>httpx>=0.28.1</code>).</dd></dl><p><strong>Why this way?</strong> Resolving all groups together prevents &ldquo;dependency hell&rdquo;
where adding a test tool later breaks your runtime environment.
If a conflict exists, <code>uv</code> finds it immediately rather than at deployment time.
Also, the same versions of everything are installed at all times, so the behavior (and the bugs)
of your project does not change when certain dependency groups are activated or deactivated.</p><h2 id=lockfiles>Lockfiles<a class=anchor href=#lockfiles>#</a></h2><p>The <code>uv.lock</code> file is what powers reproducibility in `uv.</p><dl><dt>What it contains</dt><dd>Every single package in your environment (direct and transitive), its exact version, the source URL,
and a cryptographic hash (SHA-256) of the file.
Why it exists</dd><dd>To eliminate &ldquo;works on my machine.&rdquo;
It records exactly what was used during a successful resolution, no matter where it is being installed.
Why it belongs in Git</dd><dd>By checking in <code>uv.lock</code>, you ensure that every developer, every CI runner,
and every production deployment uses the <em>exact</em> same bytes for every dependency.</dd></dl><h2 id=uv-sync-and-uv-run><code>uv sync</code> and <code>uv run</code><a class=anchor href=#uv-sync-and-uv-run>#</a></h2><p>These commands are consumers of the lockfile.</p><dl><dt>Authority</dt><dd>The <code>uv.lock</code> file is authoritative.
When you run <code>uv sync</code>, <code>uv</code> doesn&rsquo;t look at PyPI to see if there&rsquo;s a newer version;
it looks at the lockfile and makes your <code>.venv</code> match it exactly.
You can tell <code>uv sync</code> to activate or deactivate dependency groups, though.
Automatic Sync</dd><dd><code>uv run</code> will automatically check if your <code>pyproject.toml</code> or <code>uv.lock</code> has changed
and perform a hidden <code>uv sync</code> if needed.</dd></dl><p><strong>Why this way?</strong> This makes the virtual environment a &ldquo;derived artifact.&rdquo;
You don&rsquo;t &ldquo;manage&rdquo; the <code>.venv</code>; you manage the <code>pyproject.toml</code> and <code>uv.lock</code>, and <code>uv</code> makes the <code>.venv</code> happen.</p><h2 id=upgrading-with-uv-lock>Upgrading with <code>uv lock</code><a class=anchor href=#upgrading-with-uv-lock>#</a></h2><p>To update your dependencies to newer versions allowed by your <code>pyproject.toml</code> constraints, use:</p><ul><li><code>uv lock --upgrade</code>: Upgrades all dependencies to the latest compatible versions.</li><li><code>uv lock --upgrade-package httpx</code>: Upgrades only <code>httpx</code> (and its dependencies if necessary).</li></ul><p>This updates the <code>uv.lock</code> file, which you then test and commit.</p><h2 id=sharing-projects-and-deterministic-installs>Sharing projects and deterministic installs<a class=anchor href=#sharing-projects-and-deterministic-installs>#</a></h2><p>When a teammate clones the <code>berlin-weather</code> repo, they just run <code>uv sync</code>.</p><ul><li><code>uv</code> reads <code>uv.lock</code>.</li><li><code>uv</code> downloads the exact wheels (verified by hashes).</li><li><code>uv</code> creates a <code>.venv</code> identical to yours.</li></ul><p>This is a <strong>deterministic install</strong>.
The result is guaranteed to be the same regardless of when or where the command is run.</p><h1 id=dependencies-and-docker-installs>Dependencies and Docker Installs<a class=anchor href=#dependencies-and-docker-installs>#</a></h1><p>In a development environment, we usually want everything: the project, the runtime dependencies,
and the development tools.
But in a Docker container (especially for production), we want the opposite: as little as possible.</p><p><code>uv sync</code> provides several options to control exactly what gets installed, which is crucial for building small,
efficient, and well-cached Docker images.</p><h2 id=layer-caching-and---no-install-project>Layer Caching and <code>--no-install-project</code><a class=anchor href=#layer-caching-and---no-install-project>#</a></h2><p>Docker builds are faster when they can reuse previous layers.
The most expensive part of a Python build is usually installing dependencies.</p><p>If we copy our entire project and then run <code>uv sync</code>,
any small change to our source code will invalidate the Docker cache, forcing a full re-install of all dependencies.</p><p>To avoid this, we use the &ldquo;dependency-first&rdquo; pattern:</p><ol><li><strong>Copy metadata only</strong>: Copy <code>pyproject.toml</code> and <code>uv.lock</code> first.</li><li><strong>Install dependencies</strong>: Run <code>uv sync --frozen --no-cache --no-install-project</code>.<ul><li><code>--frozen</code>: Ensures that <code>uv</code> does not update the <code>uv.lock</code> file. It will fail if the lockfile is out of sync with <code>pyproject.toml</code>. This is critical for reproducible builds.</li><li><code>--no-cache</code>: Prevents <code>uv</code> from using the local cache.
In Docker, avoiding the cache helps keep the image size down if we don&rsquo;t manage a persistent cache volume.
Instead, your environments cache on the network is being used, that is,
images are pulled from artifactory or whatever else is configured.
But no <code>$HOME/.cache</code> is being used.</li><li><code>--no-install-project</code>: Installs all dependencies into <code>.venv</code> but skips installing the project itself (the code in <code>src/</code>).</li></ul></li><li><strong>Copy source code</strong>: Copy the rest of your application code.</li><li><strong>Final Sync</strong>: Run <code>uv sync --frozen --no-cache</code>. This will be nearly instant because the dependencies are already cached in a Docker layer.</li></ol><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#78787e># Install dependencies first to leverage Docker layer caching</span><span style=color:#ff5c57>
</span></span></span><span style=display:flex><span><span style=color:#ff6ac1>COPY</span> pyproject.toml uv.lock ./<span style=color:#ff5c57>
</span></span></span><span style=display:flex><span><span style=color:#ff6ac1>RUN</span> uv sync --frozen --no-cache --no-install-project<span style=color:#ff5c57>
</span></span></span><span style=display:flex><span><span style=color:#ff5c57>
</span></span></span><span style=display:flex><span><span style=color:#78787e># Now copy the source code and install the project</span><span style=color:#ff5c57>
</span></span></span><span style=display:flex><span><span style=color:#ff6ac1>COPY</span> . .<span style=color:#ff5c57>
</span></span></span><span style=display:flex><span><span style=color:#ff6ac1>RUN</span> uv sync --frozen --no-cache</span></span></code></pre></div><p>Dependencies change less often than the source code itself,
so Docker layer caching can kick in and our build speed will be higher
than if we did the install in the normal order (source code first,
dependencies second).</p><h2 id=reducing-image-size-with---no-dev-and---only-group>Reducing Image Size with <code>--no-dev</code> and <code>--only-group</code><a class=anchor href=#reducing-image-size-with---no-dev-and---only-group>#</a></h2><p>Production images should not contain <code>pytest</code>, <code>ruff</code>, or <code>mypy</code>.
These tools take up space and increase the attack surface of your container.</p><ul><li><code>--no-dev</code>: Excludes the <code>dev</code> dependency group.</li><li><code>--no-group &lt;name></code>: Excludes a specific group (e.g., <code>--no-group test</code>).</li><li><code>--only-group &lt;name></code>: Installs <em>only</em> the specified group.
Note that this <strong>excludes</strong> the base <code>project.dependencies</code> and the project itself.</li><li><code>--no-install-local</code>: Skips the project and any local path dependencies. This is ideal for caching only heavy third-party packages from PyPI in an early Docker layer.</li></ul><p>For a production web service, you might use:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv sync --frozen --no-dev --no-group test</span></span></code></pre></div><p>If you want an image that contains <em>only</em> the tools needed for testing, you might use:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uv sync --frozen --only-group test</span></span></code></pre></div><p>and use this as a base layer for the &ldquo;dependencies first install&rdquo; outlines above.</p><h2 id=summary-of-exclusions>Summary of Exclusions<a class=anchor href=#summary-of-exclusions>#</a></h2><table><thead><tr><th style=text-align:left>Option</th><th style=text-align:left>Effect</th></tr></thead><tbody><tr><td style=text-align:left><code>--no-install-project</code></td><td style=text-align:left>Skips installing the current project, but keeps its dependencies.</td></tr><tr><td style=text-align:left><code>--no-install-local</code></td><td style=text-align:left>Skips the project and all local/path dependencies. Best for caching.</td></tr><tr><td style=text-align:left><code>--no-dev</code></td><td style=text-align:left>Omits the <code>dev</code> group.</td></tr><tr><td style=text-align:left><code>--no-group &lt;name></code></td><td style=text-align:left>Omits a specific named group.</td></tr><tr><td style=text-align:left><code>--only-group &lt;name></code></td><td style=text-align:left>Installs ONLY the named group (omits project and base deps).</td></tr><tr><td style=text-align:left><code>--no-default-groups</code></td><td style=text-align:left>Skips the default <code>dev</code> group.</td></tr></tbody></table><p>By combining these flags, you can ensure that your CI environments get exactly the test tools they need,
while your production images remain lean and focused.</p><h1 id=installation>Installation<a class=anchor href=#installation>#</a></h1><p>While <code>uv sync</code> is the primary command to ensure your environment matches your lockfile,
several options control <em>how</em> that installation happens.
These options are crucial for optimizing performance, managing disk space,
and ensuring reliability in different environments.</p><h2 id=installer-options>Installer Options<a class=anchor href=#installer-options>#</a></h2><p>These flags control the mechanics of how packages are placed into your <code>.venv</code>.</p><h3 id=--link-mode><code>--link-mode</code><a class=anchor href=#--link-mode>#</a></h3><p><code>uv</code> uses a global cache to avoid downloading the same packages repeatedly. The <code>--link-mode</code> option determines how packages are moved from this cache into your project&rsquo;s <code>site-packages</code>:</p><ul><li><code>clone</code> (default on macOS): Uses &ldquo;copy-on-write&rdquo; clones.
It&rsquo;s fast and doesn&rsquo;t take extra disk space, but allows the OS to separate files if they are modified.
It requires that the cache directory is on the same filesystem as the <code>.venv</code>.
That means it will not work with the user home on the internal disk, and the work directory on an external USB or network drive.</li><li><code>hardlink</code> (default on Linux/Windows): Creates hard links.
Extremely fast and uses zero additional space, but files are shared across all environments.
But the <code>.venv</code> and the cache must be on the same filesystem for this to work.</li><li><code>copy</code>: Physically copies the files.
Slower and uses more disk space, but ensures the environment is completely independent of the cache.</li><li><code>symlink</code>: Creates symbolic links.
Fast, but dangerous: if you clear the <code>uv</code> cache, your virtual environments will break because the target files are gone.
Use of this mode is discouraged.</li></ul><h3 id=--reinstall-and---reinstall-package><code>--reinstall</code> and <code>--reinstall-package</code><a class=anchor href=#--reinstall-and---reinstall-package>#</a></h3><ul><li><code>--reinstall</code>: Forces <code>uv</code> to reinstall all packages even if they are already present. This is a &ldquo;nuclear option&rdquo; for fixing a corrupted environment.</li><li><code>--reinstall-package &lt;name></code>: Reinstalls only the specified package.</li></ul><h3 id=--compile-bytecode><code>--compile-bytecode</code><a class=anchor href=#--compile-bytecode>#</a></h3><p>By default, Python compiles <code>.py</code> files to <code>.pyc</code> bytecode lazily (the first time they are imported).
Using <code>--compile-bytecode</code> during <code>uv sync</code> forces this compilation for all packages immediately.</p><ul><li><strong>Pros</strong>: Faster application startup time.</li><li><strong>Cons</strong>: Longer installation time.</li><li><strong>Usage</strong>: Highly recommended for Docker images and CLI tools where startup latency matters.</li></ul><h2 id=cache-options>Cache Options<a class=anchor href=#cache-options>#</a></h2><p>The <code>uv</code> cache is the heart of its speed.
See where it is located with <code>uv cache dir</code>.
By default, on MacOS and Linux, <code>$HOME/.cache/uv</code>.</p><ul><li><code>--no-cache</code>: Tells <code>uv</code> to ignore the global cache entirely for the current operation.<ul><li><strong>In Docker</strong>: Use this to keep your image small if you aren&rsquo;t using a persistent cache mount.</li><li><strong>Debugging</strong>: Use this to rule out cache corruption issues.</li></ul></li><li><code>--refresh</code>: Invalidates all cached data and re-downloads everything.</li><li><code>--refresh-package &lt;name></code>: Refreshes the cache for a specific package.</li></ul><p>In a normal development workflow, you rarely need these.
But in a CI/CD pipeline,
<code>--refresh</code> ensures you are getting the absolute latest files if a package was re-published with the same version
(which shouldn&rsquo;t happen, but sometimes does in private registries).</p><h2 id=python-discovery-and-managed-python>Python Discovery and Managed Python<a class=anchor href=#python-discovery-and-managed-python>#</a></h2><p><code>uv</code> needs a Python interpreter to create a virtual environment.
It will use locally installed python versions (e.g. system python or homebrew installed python) if found.</p><p>It searches for one in this order:</p><ol><li>An active virtual environment (e.g., if you set <code>VIRTUAL_ENV</code>).</li><li>A <code>.python-version</code> file in the current or parent directory.</li><li>The <code>requires-python</code> constraint in <code>pyproject.toml</code>.</li><li>System-wide installations (Path, Homebrew, etc.).</li></ol><p>With <code>--managed-python</code> it does not do that, but installs a specific, known build of Python.
This ensures that everyone on the team uses the exact same interpreter.</p><h3 id=--managed-python><code>--managed-python</code><a class=anchor href=#--managed-python>#</a></h3><p>We strongly recommend using <code>uv</code> to manage your Python versions (<code>--managed-python</code>).</p><ul><li><strong>Reproducibility</strong>: <code>uv</code> downloads specific, known builds of Python, ensuring everyone on the team uses the exact same interpreter.</li><li><strong>Isolation</strong>: It avoids the &ldquo;polluted&rdquo; system Python which might have OS-specific packages installed.</li></ul><p><strong>The Python Build Standalone Caveat</strong>:
The
<a href=https://github.com/astral-sh/python-build-standalone><code>python-build-standalone</code></a>
project used by <code>uv</code> to build managed Python versions does not include the <code>tkinter</code> module by default.
This is because it is not a cross-platform solution and requires the system&rsquo;s Tcl/Tk libraries to be installed.
If your application requires a GUI built with <code>tkinter</code>,
you might need to use a &ldquo;local&rdquo; Python (like one installed via Homebrew or a system installer, plus <code>python-tk</code>)
that is linked against your OS&rsquo;s windowing system.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/books/uv-class/04-basics/ class="flex align-center"><img src=/icons/backward.svg class=book-icon alt=Backward>
<span>General Options and TOML</span>
</a></span><span><a href=/books/uv-class/06-running/ class="flex align-center"><span>Running code and tools consistently</span>
<img src=/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#topics>Topics</a></li></ul></li><li><a href=#python-projects-and-dependencies>Python Projects and Dependencies</a><ul><li><a href=#adding-and-removing-dependencies>Adding and removing dependencies</a><ul><li><a href=#uv-add><code>uv add</code></a></li><li><a href=#uv-remove><code>uv remove</code></a></li></ul></li><li><a href=#runtime-vs-development-dependencies>Runtime vs development dependencies</a><ul><li><a href=#runtime-dependencies>Runtime Dependencies</a></li><li><a href=#development-dependencies---dev>Development Dependencies (<code>--dev</code>)</a></li><li><a href=#dependency-groups---group-name>Dependency Groups (<code>--group &lt;name></code>)</a></li></ul></li><li><a href=#dependency-resolution>Dependency resolution</a></li><li><a href=#lockfiles>Lockfiles</a></li><li><a href=#uv-sync-and-uv-run><code>uv sync</code> and <code>uv run</code></a></li><li><a href=#upgrading-with-uv-lock>Upgrading with <code>uv lock</code></a></li><li><a href=#sharing-projects-and-deterministic-installs>Sharing projects and deterministic installs</a></li></ul></li><li><a href=#dependencies-and-docker-installs>Dependencies and Docker Installs</a><ul><li><a href=#layer-caching-and---no-install-project>Layer Caching and <code>--no-install-project</code></a></li><li><a href=#reducing-image-size-with---no-dev-and---only-group>Reducing Image Size with <code>--no-dev</code> and <code>--only-group</code></a></li><li><a href=#summary-of-exclusions>Summary of Exclusions</a></li></ul></li><li><a href=#installation>Installation</a><ul><li><a href=#installer-options>Installer Options</a><ul><li><a href=#--link-mode><code>--link-mode</code></a></li><li><a href=#--reinstall-and---reinstall-package><code>--reinstall</code> and <code>--reinstall-package</code></a></li><li><a href=#--compile-bytecode><code>--compile-bytecode</code></a></li></ul></li><li><a href=#cache-options>Cache Options</a></li><li><a href=#python-discovery-and-managed-python>Python Discovery and Managed Python</a><ul><li><a href=#--managed-python><code>--managed-python</code></a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>